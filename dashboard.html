<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Clothing Store Inventory</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Main Application -->
    <div class="app-container">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>Clothing Store</h2>
                <button class="sidebar-toggle" id="sidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            <ul class="sidebar-menu">
                <li><a href="#" data-section="dashboard" class="menu-item active">
                    <i class="fas fa-chart-dashboard"></i>
                    <span>Analytics Dashboard</span>
                </a></li>
                <li><a href="#" data-section="products" class="menu-item">
                    <i class="fas fa-tshirt"></i>
                    <span>Inventory Management</span>
                </a></li>
                <li><a href="#" data-section="categories" class="menu-item">
                    <i class="fas fa-tags"></i>
                    <span>Categories</span>
                </a></li>
                <li><a href="#" data-section="reports" class="menu-item">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reports</span>
                </a></li>
                <li class="admin-only"><a href="#" data-section="users" class="menu-item">
                    <i class="fas fa-users"></i>
                    <span>Users</span>
                </a></li>
                <li><a href="#" data-section="settings" class="menu-item">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <header class="app-header">
                <div class="header-left">
                    <button class="mobile-menu-toggle" id="mobileMenuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 class="page-title" id="pageTitle">Dashboard</h1>
                </div>
                <div class="header-right">
                    <div class="notification-icon">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notificationBadge">3</span>
                    </div>
                    <div class="user-menu">
                        <div class="user-info" id="userInfo">
                            <span class="user-name">John Doe</span>
                            <span class="user-role">Admin</span>
                        </div>
                        <div class="user-dropdown">
                            <button class="user-avatar" id="userDropdown">
                                <i class="fas fa-user-circle"></i>
                            </button>
                            <div class="dropdown-menu" id="userDropdownMenu">
                                <a href="#">Profile</a>
                                <a href="#">Settings</a>
                                <a href="#" id="logoutBtn">Logout</a>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Dashboard Section - Analytics Overview -->
            <section id="dashboardSection" class="content-section active">
                <div class="dashboard-header" style="margin-bottom: var(--space-32); text-align: center;">
                    <h2 style="margin-bottom: var(--space-8);">Analytics Dashboard</h2>
                    <p style="color: var(--color-text-secondary); margin: 0;">Complete overview of your clothing store performance and metrics</p>
                </div>
                
                <!-- KPI Cards -->
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-icon">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="kpi-content">
                            <h3 id="totalProducts">0</h3>
                            <p>Total Items</p>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon warning">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="kpi-content">
                            <h3 id="lowStockItems">0</h3>
                            <p>Low Stock Items</p>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon danger">
                            <i class="fas fa-times-circle"></i>
                        </div>
                        <div class="kpi-content">
                            <h3 id="outOfStock">0</h3>
                            <p>Out of Stock</p>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon success">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="kpi-content">
                            <h3 id="totalValue">$0</h3>
                            <p>Total Value</p>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="kpi-content">
                            <h3 id="monthlySales">$0</h3>
                            <p>Monthly Sales</p>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="kpi-content">
                            <h3 id="activeUsers">0</h3>
                            <p>Active Users</p>
                        </div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="charts-grid">
                    <div class="card">
                        <div class="card__body">
                            <h3>Sales Trend</h3>
                            <div class="chart-container">
                                <canvas id="salesChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card__body">
                            <h3>Stock by Category</h3>
                            <div class="chart-container">
                                <canvas id="stockChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activities -->
                <div class="card">
                    <div class="card__body">
                        <h3>Recent Activities</h3>
                        <div class="activities-list" id="activitiesList">
                            <!-- Activities will be loaded here -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Products Section - Inventory Management -->
            <section id="productsSection" class="content-section">
                <div class="section-header">
                    <h2>Inventory Management</h2>
                    <div class="header-actions">
                        <button class="btn btn--primary" id="addProductBtn">
                            <i class="fas fa-plus"></i> Add Product
                        </button>
                    </div>
                </div>

                <!-- Product Stats -->
                <div id="productStatsContainer" style="display: none; margin-bottom: var(--space-24);"></div>

                <!-- Filters -->
                <div class="filters-row">
                    <div class="search-box">
                        <input type="text" id="productSearch" class="form-control" placeholder="Search products...">
                        <i class="fas fa-search"></i>
                    </div>
                    <select id="categoryFilter" class="form-control">
                        <option value="">All Categories</option>
                    </select>
                </div>

                <!-- Products Table -->
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>SKU</th>
                                <th>Category</th>
                                <th>Size/Color</th>
                                <th>Stock</th>
                                <th>Price</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="productsTableBody">
                            <!-- Products will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Categories Section -->
            <section id="categoriesSection" class="content-section">
                <div class="section-header">
                    <h2>Category Management</h2>
                    <div class="header-actions">
                        <button class="btn btn--primary" id="addCategoryBtn">
                            <i class="fas fa-plus"></i> Add Category
                        </button>
                    </div>
                </div>

                <div class="categories-grid" id="categoriesGrid">
                    <!-- Categories will be loaded here -->
                </div>
            </section>

            <!-- Reports Section -->
            <section id="reportsSection" class="content-section">
                <div class="section-header">
                    <h2>Detailed Reports</h2>
                </div>

                <div class="reports-grid">
                    <div class="card">
                        <div class="card__body">
                            <h3>Low Stock Alert</h3>
                            <div class="report-content">
                                <div id="lowStockReport">
                                    <!-- Low stock items will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card__body">
                            <h3>Category Summary</h3>
                            <div class="report-content">
                                <div id="categorySummary">
                                    <!-- Category summary will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Users Section -->
            <section id="usersSection" class="content-section">
                <div class="section-header">
                    <h2>User Management</h2>
                    <div class="header-actions">
                        <button class="btn btn--primary" id="addUserBtn">
                            <i class="fas fa-plus"></i> Add User
                        </button>
                    </div>
                </div>

                <!-- Users Stats -->
                <div class="users-stats" style="display: none; margin-bottom: var(--space-24);">
                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <div class="kpi-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="kpi-content">
                                <h3 id="totalUsersCount">0</h3>
                                <p>Total Users</p>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon success">
                                <i class="fas fa-user-check"></i>
                            </div>
                            <div class="kpi-content">
                                <h3 id="activeUsersCount">0</h3>
                                <p>Active Users</p>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon warning">
                                <i class="fas fa-user-shield"></i>
                            </div>
                            <div class="kpi-content">
                                <h3 id="adminUsersCount">0</h3>
                                <p>Administrators</p>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="kpi-content">
                                <h3 id="recentLoginsCount">0</h3>
                                <p>Recent Logins</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Users Table -->
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Details</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Users will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Settings Section -->
            <section id="settingsSection" class="content-section">
                <div class="section-header">
                    <h2>System Settings</h2>
                </div>

                <div class="settings-grid">
                    <div class="card">
                        <div class="card__body">
                            <h3>Profile Settings</h3>
                            <form id="profileForm">
                                <div class="form-group">
                                    <label class="form-label">Name</label>
                                    <input type="text" id="profileName" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Email</label>
                                    <input type="email" id="profileEmail" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Role</label>
                                    <input type="text" id="profileRole" class="form-control" readonly>
                                </div>
                                <button type="submit" class="btn btn--primary">Update Profile</button>
                            </form>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card__body">
                            <h3>System Preferences</h3>
                            <div class="preference-item">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="emailNotifications">
                                    Email Notifications
                                </label>
                            </div>
                            <div class="preference-item">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="autoReorder">
                                    Auto Reorder Alerts
                                </label>
                            </div>
                            <div class="preference-item">
                                <label class="form-label">Low Stock Threshold</label>
                                <input type="range" id="stockThreshold" class="form-range" min="10" max="50" value="20">
                                <div class="range-value">20%</div>
                            </div>
                            <button class="btn btn--primary" onclick="saveSystemPreferences()">Save Preferences</button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card__body">
                            <h3>Security</h3>
                            <div class="security-item">
                                <div class="security-info">
                                    <strong>Change Password</strong>
                                    <small>Update your account password</small>
                                </div>
                                <button class="btn btn--outline" onclick="changePassword()">Change</button>
                            </div>
                            <div class="security-item">
                                <div class="security-info">
                                    <strong>Logout All Sessions</strong>
                                    <small>Sign out from all devices</small>
                                </div>
                                <button class="btn btn--outline" onclick="logoutAllSessions()">Logout All</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Product Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="productModalTitle">Add Product</h3>
                <button class="modal-close" id="closeProductModal">&times;</button>
            </div>
            <form id="productForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Product Name</label>
                        <input type="text" id="productName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">SKU</label>
                        <input type="text" id="productSku" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Category</label>
                        <select id="productCategory" class="form-control" required>
                            <option value="">Select Category</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Price</label>
                        <input type="number" id="productPrice" class="form-control" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Cost</label>
                        <input type="number" id="productCost" class="form-control" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Current Stock</label>
                        <input type="number" id="productStock" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Min Stock</label>
                        <input type="number" id="productMinStock" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Max Stock</label>
                        <input type="number" id="productMaxStock" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Size</label>
                        <select id="productSize" class="form-control">
                            <option value="">Select Size</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Color</label>
                        <select id="productColor" class="form-control">
                            <option value="">Select Color</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Material</label>
                        <select id="productMaterial" class="form-control">
                            <option value="">Select Material</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Brand</label>
                        <select id="productBrand" class="form-control">
                            <option value="">Select Brand</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Season</label>
                        <select id="productSeason" class="form-control">
                            <option value="">Select Season</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Image URL</label>
                        <input type="url" id="productImage" class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea id="productDescription" class="form-control" rows="3"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn--secondary" id="cancelProductModal">Cancel</button>
                    <button type="submit" class="btn btn--primary">Save Product</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="app.js"></script>
    <script>
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸ“Š Dashboard Page Loaded');
            
            // Check authentication
            const currentUser = JSON.parse(sessionStorage.getItem('currentUser') || 'null');
            const loginTime = sessionStorage.getItem('loginTime');
            
            if (!currentUser || !loginTime) {
                // Redirect to login if not authenticated
                window.location.href = 'login.html';
                return;
            }
            
            // Check session expiry (8 hours)
            const sessionAge = Date.now() - parseInt(loginTime);
            const maxSessionAge = 8 * 60 * 60 * 1000; // 8 hours
            
            if (sessionAge > maxSessionAge) {
                sessionStorage.clear();
                showToast('Session expired. Please login again.', 'warning');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 2000);
                return;
            }
            
            // Initialize application with user data
            initializeDashboard(currentUser);
        });

        function initializeDashboard(user) {
            // Update user info in header
            document.querySelector('.user-name').textContent = user.name;
            document.querySelector('.user-role').textContent = user.role;
            
            // Show/hide admin-only elements
            if (user.role === 'Admin') {
                document.body.classList.add('role-admin');
            } else {
                document.body.classList.remove('role-admin');
            }
            
            // Initialize event listeners
            initializeEventListeners();
            
            // Load initial data
            loadDashboardData();
            
            // Show welcome message
            showToast(`Welcome back, ${user.name}!`, 'success');
        }

        function initializeEventListeners() {
            // Navigation
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = e.currentTarget.getAttribute('data-section');
                    navigateToSection(section);
                });
            });

            // Mobile menu
            document.getElementById('mobileMenuToggle').addEventListener('click', toggleMobileMenu);
            document.getElementById('sidebarToggle').addEventListener('click', toggleSidebar);

            // User dropdown
            document.getElementById('userDropdown').addEventListener('click', toggleUserDropdown);

            // Logout
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);

            // Product management
            document.getElementById('addProductBtn').addEventListener('click', showAddProductModal);
            document.getElementById('closeProductModal').addEventListener('click', hideProductModal);
            document.getElementById('cancelProductModal').addEventListener('click', hideProductModal);

            // Search and filters
            document.getElementById('productSearch').addEventListener('input', renderProductsTable);
            document.getElementById('categoryFilter').addEventListener('change', renderProductsTable);

            // Category management
            document.getElementById('addCategoryBtn').addEventListener('click', showAddCategoryModal);

            // User management
            document.getElementById('addUserBtn').addEventListener('click', showAddUserModal);

            // Close modals when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    hideProductModal();
                }
            });

            // Close dropdowns when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.user-dropdown')) {
                    document.getElementById('userDropdownMenu').classList.remove('show');
                }
            });
        }

        function navigateToSection(sectionName) {
            // Update active menu item
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-section="${sectionName}"]`).classList.add('active');
            
            // Update page title
            const titles = {
                dashboard: 'Analytics Dashboard',
                products: 'Inventory Management',
                categories: 'Category Management',
                reports: 'Detailed Reports',
                users: 'User Management',
                settings: 'System Settings'
            };
            document.getElementById('pageTitle').textContent = titles[sectionName] || sectionName;
            
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(`${sectionName}Section`).classList.add('active');
            
            // Load section-specific content
            switch(sectionName) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'products':
                    loadProductsData();
                    break;
                case 'categories':
                    loadCategoriesData();
                    break;
                case 'reports':
                    loadReportsData();
                    break;
                case 'users':
                    loadUsersData();
                    break;
                case 'settings':
                    loadSettingsData();
                    break;
            }
            
            // Close mobile menu if open
            document.getElementById('sidebar').classList.remove('show');
        }

        // Sample data storage
        const sampleData = {
            categories: [
                { id: 1, name: "Shirts & Tops", description: "T-shirts, blouses, tank tops" },
                { id: 2, name: "Pants & Bottoms", description: "Jeans, trousers, shorts" },
                { id: 3, name: "Dresses & Skirts", description: "Casual and formal dresses" },
                { id: 4, name: "Outerwear", description: "Jackets, coats, blazers" },
                { id: 5, name: "Footwear", description: "Shoes, boots, sandals" }
            ],
            products: [
                { id: 1, name: "Classic White Shirt", sku: "CWS001", categoryId: 1, category: "Shirts & Tops", price: 45.99, cost: 22.00, stock: 15, minStock: 10, maxStock: 100, size: "M", color: "White", image: "https://images.unsplash.com/photo-1596755094514-f87e34085b2c?w=150" },
                { id: 2, name: "Slim Fit Jeans", sku: "SFJ002", categoryId: 2, category: "Pants & Bottoms", price: 79.99, cost: 35.00, stock: 8, minStock: 12, maxStock: 80, size: "32", color: "Blue", image: "https://images.unsplash.com/photo-1542272604-787c3835535d?w=150" },
                { id: 3, name: "Summer Dress", sku: "SD003", categoryId: 3, category: "Dresses & Skirts", price: 89.99, cost: 40.00, stock: 25, minStock: 15, maxStock: 60, size: "S", color: "Floral", image: "https://images.unsplash.com/photo-1595777457583-95e059d581b8?w=150" },
                { id: 4, name: "Leather Jacket", sku: "LJ004", categoryId: 4, category: "Outerwear", price: 199.99, cost: 95.00, stock: 6, minStock: 8, maxStock: 30, size: "L", color: "Black", image: "https://images.unsplash.com/photo-1551028719-00167b16eac5?w=150" },
                { id: 5, name: "Running Sneakers", sku: "RS005", categoryId: 5, category: "Footwear", price: 129.99, cost: 65.00, stock: 22, minStock: 18, maxStock: 75, size: "9", color: "Gray", image: "https://images.unsplash.com/photo-1549298916-b41d501d3772?w=150" }
            ],
            activities: [
                { user: 'John Doe', action: 'Added new product', details: 'Summer Dress - Floral', time: '2 hours ago', type: 'success' },
                { user: 'Jane Smith', action: 'Updated stock', details: 'Running Sneakers: +25 units', time: '3 hours ago', type: 'info' },
                { user: 'Mike Johnson', action: 'Low stock alert', details: 'Leather Jacket below minimum', time: '4 hours ago', type: 'warning' }
            ]
        };

        function loadDashboardData() {
            const products = sampleData.products;
            const totalProducts = products.length;
            const lowStockItems = products.filter(p => p.stock < p.minStock).length;
            const outOfStock = products.filter(p => p.stock === 0).length;
            const totalValue = products.reduce((sum, p) => sum + (p.stock * p.price), 0);
            const monthlySales = 23456.78;
            const activeUsers = 8;

            // Update KPIs
            document.getElementById('totalProducts').textContent = totalProducts.toLocaleString();
            document.getElementById('lowStockItems').textContent = lowStockItems.toLocaleString();
            document.getElementById('outOfStock').textContent = outOfStock.toLocaleString();
            document.getElementById('totalValue').textContent = `$${totalValue.toLocaleString('en-US', {minimumFractionDigits: 2})}`;
            document.getElementById('monthlySales').textContent = `$${monthlySales.toLocaleString('en-US', {minimumFractionDigits: 2})}`;
            document.getElementById('activeUsers').textContent = activeUsers.toLocaleString();

            // Update notification badge
            const totalAlerts = lowStockItems + outOfStock;
            const badge = document.getElementById('notificationBadge');
            badge.textContent = totalAlerts;
            badge.style.display = totalAlerts > 0 ? 'block' : 'none';

            // Load charts
            loadCharts();
            loadActivities();
        }

        function loadCharts() {
            // Sales trend chart
            const salesCtx = document.getElementById('salesChart');
            if (salesCtx) {
                const salesChart2D = salesCtx.getContext('2d');
                new Chart(salesChart2D, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Sales ($)',
                            data: [12000, 15000, 13000, 18000, 16000, 20000],
                            borderColor: '#1FB8CD',
                            backgroundColor: 'rgba(31, 184, 205, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '$' + value.toLocaleString();
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }

            // Stock by category chart
            const stockCtx = document.getElementById('stockChart');
            if (stockCtx) {
                const stockChart2D = stockCtx.getContext('2d');
                const categoryData = sampleData.categories.map(cat => {
                    const products = sampleData.products.filter(p => p.categoryId === cat.id);
                    return {
                        name: cat.name,
                        stock: products.reduce((sum, p) => sum + p.stock, 0)
                    };
                });

                new Chart(stockChart2D, {
                    type: 'doughnut',
                    data: {
                        labels: categoryData.map(d => d.name),
                        datasets: [{
                            data: categoryData.map(d => d.stock),
                            backgroundColor: ['#1FB8CD', '#FFC185', '#B4413C', '#ECEBD5', '#5D878F'],
                            borderWidth: 2,
                            borderColor: 'var(--color-surface)'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
        }

        function loadActivities() {
            const container = document.getElementById('activitiesList');
            const activities = sampleData.activities;

            container.innerHTML = activities.map(activity => `
                <div class="activity-item">
                    <div class="activity-icon ${activity.type}">
                        <i class="fas fa-${activity.type === 'success' ? 'plus-circle' : activity.type === 'info' ? 'edit' : 'exclamation-triangle'}"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-action">
                            <strong>${activity.user}</strong> ${activity.action.toLowerCase()}
                        </div>
                        <div class="activity-details">${activity.details}</div>
                    </div>
                    <div class="activity-time">${activity.time}</div>
                </div>
            `).join('');
        }

        function loadProductsData() {
            loadCategoryFilter();
            renderProductsTable();
            updateProductStats();
        }

        function loadCategoryFilter() {
            const filter = document.getElementById('categoryFilter');
            filter.innerHTML = '<option value="">All Categories</option>';
            sampleData.categories.forEach(cat => {
                filter.innerHTML += `<option value="${cat.name}">${cat.name}</option>`;
            });
        }

        function renderProductsTable() {
            const tbody = document.getElementById('productsTableBody');
            const searchTerm = document.getElementById('productSearch').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            
            let filteredProducts = sampleData.products.filter(product => {
                const matchesSearch = !searchTerm || 
                    product.name.toLowerCase().includes(searchTerm) ||
                    product.sku.toLowerCase().includes(searchTerm);
                const matchesCategory = !categoryFilter || product.category === categoryFilter;
                return matchesSearch && matchesCategory;
            });
            
            if (filteredProducts.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px; color: var(--color-text-secondary);">
                            No products found
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = filteredProducts.map(product => {
                const stockStatus = getStockStatus(product);
                return `
                    <tr>
                        <td>
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <img src="${product.image}" alt="${product.name}" 
                                     style="width: 40px; height: 40px; border-radius: 6px; object-fit: cover;"
                                     onerror="this.src='https://via.placeholder.com/40x40/cccccc/666666?text=IMG'">
                                <div>
                                    <strong>${product.name}</strong><br>
                                    <small style="color: var(--color-text-secondary);">${product.category}</small>
                                </div>
                            </div>
                        </td>
                        <td><code>${product.sku}</code></td>
                        <td><span class="status status--info">${product.category}</span></td>
                        <td>
                            <div style="text-align: center;">
                                <strong>${product.size}</strong><br>
                                <small style="color: var(--color-text-secondary);">${product.color}</small>
                            </div>
                        </td>
                        <td>
                            <div style="text-align: center;">
                                <span class="stock-badge ${stockStatus.class}">${product.stock}</span><br>
                                <small style="color: var(--color-text-secondary);">Min: ${product.minStock}</small>
                            </div>
                        </td>
                        <td>
                            <strong>$${product.price.toFixed(2)}</strong><br>
                            <small style="color: var(--color-text-secondary);">Cost: $${product.cost.toFixed(2)}</small>
                        </td>
                        <td><span class="status status--${stockStatus.class === 'low' ? 'error' : 'success'}">${stockStatus.text}</span></td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn--sm btn--outline btn-icon" onclick="editProduct(${product.id})" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn--sm btn--outline btn-icon" onclick="deleteProduct(${product.id})" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function getStockStatus(product) {
            if (product.stock === 0) {
                return { class: 'low', text: 'Out of Stock' };
            } else if (product.stock < product.minStock) {
                return { class: 'low', text: 'Low Stock' };
            } else {
                return { class: 'normal', text: 'In Stock' };
            }
        }

        function updateProductStats() {
            const products = sampleData.products;
            const lowStockCount = products.filter(p => p.stock < p.minStock).length;
            const outOfStockCount = products.filter(p => p.stock === 0).length;
            const totalValue = products.reduce((sum, p) => sum + (p.stock * p.price), 0);
            
            const container = document.getElementById('productStatsContainer');
            if (container) {
                container.style.display = 'block';
                container.innerHTML = `
                    <div style="display: flex; justify-content: space-around; text-align: center;">
                        <div><strong>${products.length}</strong><br><small>Total Items</small></div>
                        <div><strong style="color: var(--color-warning);">${lowStockCount}</strong><br><small>Low Stock</small></div>
                        <div><strong style="color: var(--color-error);">${outOfStockCount}</strong><br><small>Out of Stock</small></div>
                        <div><strong>$${totalValue.toLocaleString('en-US', {minimumFractionDigits: 2})}</strong><br><small>Total Value</small></div>
                    </div>
                `;
            }
        }

        function loadCategoriesData() {
            renderCategoriesGrid();
        }

        function renderCategoriesGrid() {
            const grid = document.getElementById('categoriesGrid');
            const categories = sampleData.categories;
            
            grid.innerHTML = categories.map(category => {
                const categoryProducts = sampleData.products.filter(p => p.categoryId === category.id);
                const productCount = categoryProducts.length;
                const totalStock = categoryProducts.reduce((sum, p) => sum + p.stock, 0);
                const totalValue = categoryProducts.reduce((sum, p) => sum + (p.stock * p.price), 0);
                
                return `
                    <div class="category-card">
                        <div class="category-header">
                            <h4>${category.name}</h4>
                            <div class="action-buttons">
                                <button class="btn btn--sm btn--outline btn-icon" onclick="editCategory(${category.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn--sm btn--outline btn-icon" onclick="deleteCategory(${category.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <p class="category-description">${category.description}</p>
                        <div class="category-stats">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>Products:</span>
                                <strong>${productCount}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>Total Stock:</span>
                                <strong>${totalStock}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Value:</span>
                                <strong>$${totalValue.toLocaleString('en-US', {minimumFractionDigits: 2})}</strong>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function loadReportsData() {
            loadLowStockReport();
            loadCategorySummary();
        }

        function loadLowStockReport() {
            const container = document.getElementById('lowStockReport');
            const lowStockProducts = sampleData.products.filter(p => p.stock < p.minStock);
            
            if (lowStockProducts.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--color-success);">All products are adequately stocked!</p>';
                return;
            }
            
            container.innerHTML = lowStockProducts.map(product => `
                <div class="report-item">
                    <div>
                        <strong>${product.name}</strong><br>
                        <small>SKU: ${product.sku} | Category: ${product.category}</small>
                    </div>
                    <div style="text-align: right;">
                        <span class="stock-badge low">${product.stock}</span><br>
                        <small>Min: ${product.minStock}</small>
                    </div>
                </div>
            `).join('');
        }

        function loadCategorySummary() {
            const container = document.getElementById('categorySummary');
            const summary = sampleData.categories.map(category => {
                const categoryProducts = sampleData.products.filter(p => p.categoryId === category.id);
                const totalStock = categoryProducts.reduce((sum, p) => sum + p.stock, 0);
                const totalValue = categoryProducts.reduce((sum, p) => sum + (p.stock * p.price), 0);
                
                return {
                    name: category.name,
                    productCount: categoryProducts.length,
                    totalStock,
                    totalValue
                };
            });
            
            container.innerHTML = summary.map(cat => `
                <div class="report-item">
                    <div>
                        <strong>${cat.name}</strong><br>
                        <small>${cat.productCount} products</small>
                    </div>
                    <div style="text-align: right;">
                        <strong>${cat.totalStock} items</strong><br>
                        <strong>$${cat.totalValue.toLocaleString('en-US', {minimumFractionDigits: 2})}</strong>
                    </div>
                </div>
            `).join('');
        }

        function loadUsersData() {
            // Placeholder for users data loading
            console.log('Loading users data...');
        }

        function loadSettingsData() {
            const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
            if (currentUser) {
                document.getElementById('profileName').value = currentUser.name;
                document.getElementById('profileEmail').value = currentUser.email;
                document.getElementById('profileRole').value = currentUser.role;
            }
        }

        function handleLogout() {
            sessionStorage.clear();
            showToast('You have been logged out successfully', 'success');
            setTimeout(() => {
                window.location.href = 'login.html';
            }, 1000);
        }

        function toggleMobileMenu() {
            document.getElementById('sidebar').classList.toggle('show');
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('collapsed');
        }

        function toggleUserDropdown() {
            document.getElementById('userDropdownMenu').classList.toggle('show');
        }

        function showAddProductModal() {
            populateProductForm();
            document.getElementById('productModal').classList.add('show');
        }

        function populateProductForm() {
            const categorySelect = document.getElementById('productCategory');
            categorySelect.innerHTML = '<option value="">Select Category</option>';
            sampleData.categories.forEach(cat => {
                categorySelect.innerHTML += `<option value="${cat.id}">${cat.name}</option>`;
            });
        }

        function hideProductModal() {
            document.getElementById('productModal').classList.remove('show');
        }

        function showAddCategoryModal() {
            const name = prompt('Category Name:');
            if (!name) return;
            
            const description = prompt('Category Description:');
            if (!description) return;
            
            const newCategory = {
                id: Date.now(),
                name,
                description
            };
            
            sampleData.categories.push(newCategory);
            showToast('Category added successfully!', 'success');
            renderCategoriesGrid();
            loadCategoryFilter();
        }

        function editCategory(id) {
            const category = sampleData.categories.find(c => c.id === id);
            if (!category) return;
            
            const name = prompt('Category Name:', category.name);
            if (!name) return;
            
            const description = prompt('Category Description:', category.description);
            if (!description) return;
            
            category.name = name;
            category.description = description;
            
            showToast('Category updated successfully!', 'success');
            renderCategoriesGrid();
            loadCategoryFilter();
        }

        function deleteCategory(id) {
            if (!confirm('Are you sure you want to delete this category?')) return;
            
            const index = sampleData.categories.findIndex(c => c.id === id);
            if (index !== -1) {
                sampleData.categories.splice(index, 1);
                showToast('Category deleted successfully!', 'success');
                renderCategoriesGrid();
                loadCategoryFilter();
            }
        }

        function editProduct(id) {
            showToast('Product editing feature coming soon!', 'info');
        }

        function deleteProduct(id) {
            if (!confirm('Are you sure you want to delete this product?')) return;
            
            const index = sampleData.products.findIndex(p => p.id === id);
            if (index !== -1) {
                sampleData.products.splice(index, 1);
                showToast('Product deleted successfully!', 'success');
                renderProductsTable();
                updateProductStats();
                loadDashboardData();
            }
        }

        function showAddUserModal() {
            showToast('User management feature coming soon!', 'info');
        }

        // Product form submission
        document.getElementById('productForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('productName').value;
            const sku = document.getElementById('productSku').value;
            const categoryId = parseInt(document.getElementById('productCategory').value);
            const price = parseFloat(document.getElementById('productPrice').value);
            const cost = parseFloat(document.getElementById('productCost').value);
            const stock = parseInt(document.getElementById('productStock').value);
            const minStock = parseInt(document.getElementById('productMinStock').value);
            const maxStock = parseInt(document.getElementById('productMaxStock').value);
            const size = document.getElementById('productSize').value;
            const color = document.getElementById('productColor').value;
            const description = document.getElementById('productDescription').value;
            const image = document.getElementById('productImage').value || 'https://via.placeholder.com/150';
            
            if (!name || !sku || !categoryId || !price || !cost || stock < 0 || !minStock || !maxStock) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            const category = sampleData.categories.find(c => c.id === categoryId);
            
            const newProduct = {
                id: Date.now(),
                name,
                sku,
                categoryId,
                category: category.name,
                price,
                cost,
                stock,
                minStock,
                maxStock,
                size,
                color,
                description,
                image
            };
            
            sampleData.products.push(newProduct);
            showToast('Product added successfully!', 'success');
            hideProductModal();
            renderProductsTable();
            updateProductStats();
            loadDashboardData();
            
            // Reset form
            document.getElementById('productForm').reset();
        });

        function saveSystemPreferences() {
            showToast('Preferences saved successfully!', 'success');
        }

        function changePassword() {
            const newPassword = prompt('Enter new password:');
            if (newPassword && newPassword.length >= 6) {
                showToast('Password changed successfully!', 'success');
            } else if (newPassword) {
                showToast('Password must be at least 6 characters long', 'error');
            }
        }

        function logoutAllSessions() {
            if (confirm('This will log you out from all devices. Continue?')) {
                handleLogout();
            }
        }

        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'times-circle' : 'exclamation-circle'}"></i>
                <span>${message}</span>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
    </script>
</body>
</html>